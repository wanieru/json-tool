(()=>{"use strict";var e={671:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JsonTool=void 0,t.JsonTool=class{constructor(e,t=null){var n,s;this.elementState={},this.containerElement=e,this.validator=null!=t?t:()=>({valid:!0}),this.schema=null,this.root=document.createElement("div"),this.root.style.fontFamily="monospace",this.root.style.marginLeft="30px",this.root.classList.add("json-tool"),this.rootObject=null,this.rootElement=null,this.errorMessages=document.createElement("div"),this.errorMessages.classList.add("json-tool-errors");const i=document.createElement("iframe");i.style.width="100%",i.style.height="100%",i.style.overflow="scroll",i.style.border="0",e.innerHTML="",e.appendChild(i),this.iframeBody=null===(s=i.contentDocument||(null===(n=i.contentWindow)||void 0===n?void 0:n.document))||void 0===s?void 0:s.querySelector("body"),this.iframeBody.append(this.root),this.createCss(this.iframeBody),i.onload=()=>{var e,t;this.iframeBody=null===(t=i.contentDocument||(null===(e=i.contentWindow)||void 0===e?void 0:e.document))||void 0===t?void 0:t.querySelector("body"),this.iframeBody.append(this.root),this.createCss(this.iframeBody),this.iframeBody.appendChild(this.errorMessages)}}deleteChild(e){}getState(){return this.elementState}load(e,t,s){if(this.validator=null!=s?s:this.validator,this.schema=e,this.root.innerHTML="",e.title){const t=document.createElement("h3");t.textContent=e.title,n.addDescription(t,e.description,null==e?void 0:e.examples),this.root.appendChild(t)}this.rootObject=document.createElement("div"),this.root.appendChild(this.rootObject),this.rootElement=new n("","root",this.rootObject,e,t,this),this.validate()}hide(){this.containerElement.innerHTML=""}setValidator(e){this.validator=e}getValue(){var e;return null===(e=this.rootElement)||void 0===e?void 0:e.getValue()}update(){var e;if(!this.rootObject)return;let t=1;null===(e=this.rootObject)||void 0===e||e.querySelectorAll(".line-number").forEach((e=>{e.innerText=t.toString(),t++})),this.validate()}validate(){window.setTimeout((()=>{var e;if(this.schema&&this.errorMessages){const t=this.validator(this.getValue(),this.schema);this.errorMessages.innerHTML="",t.valid||(this.errorMessages.innerHTML=(null!==(e=t.errors)&&void 0!==e?e:[]).map((e=>"string"==typeof e?e:e.message)).join("\n"))}}),1)}createCss(e){const t=document.createElement("style");e.appendChild(t),t.innerHTML="\n            .json-tool-btn\n             {\n                border: 1px black solid;\n                cursor: pointer;\n                display: block;\n             }\n              .json-tool-block > .json-tool-btn {\n                margin-top: -17px;\n                margin-left: -40px;\n                position: absolute;\n                opacity: 0;\n              }\n              .json-tool-block:hover > .json-tool-btn\n              {\n                opacity: 1;\n              }\n              .json-tool-value > .json-tool-btn {\n                margin-left: 10px;\n                display: inline-block;\n                position: absolute;\n                opacity :0;\n              }\n              .json-tool-value:hover > .json-tool-btn\n              {\n                opacity :1;\n              }\n              .json-tool-key > .json-tool-btns {\n                margin-left: -36px;\n                display: inline-block;\n                position: absolute;\n                width: 32px;\n                text-align: right;\n                opacity: 0;\n              }\n              .json-tool-key:hover > .json-tool-btns\n              {\n                opacity: 1;\n              }\n\n              .json-tool-key > .json-tool-btns > .json-tool-btn {\n                display: inline-block;\n                margin-right: 2px;\n              }\n              .json-tool-types > .json-tool-type\n              {\n                padding:0;\n                margin:0;\n                border:0;\n              }\n              .json-tool-value > .json-tool-types\n              {\n                float:right;\n                opacity: 0;\n              }\n              .json-tool-value.json-tool-object > .json-tool-types\n              {\n                float:none;\n                position: absolute;\n                margin-left: 15px;\n              }\n              .json-tool-value:hover > .json-tool-types\n              {\n                opacity: 1;\n              }\n\n              .json-tool-block.opened > .json-tool-key {display: block}\n              .json-tool-block.closed > .json-tool-key {display: none}\n\n              .line-number\n              {\n                position: absolute;\n                left: 0;\n                text-align: right;\n                width: 20px;\n              }\n              .json-tool-value.json-tool-object > .line-number\n              {\n                margin-top: -15px;\n              }\n              .json-tool input, .json-tool select, .json-tool textarea\n              {\n                border: 0;\n                background-color: #ece9e9;\n                padding: 0;\n                margin: 1px;\n              }\n\n                .json-tool-errors {\n                    color: red;\n                    white-space: pre;\n                    font-family: monospace;\n                    line-height: 2em;\n                    font-weight: bold;\n                    font-size: 1.2em;\n                }\n"}};class n{constructor(e,t,s,i,o,l){this.arrayElements=[],this.objectElements={},this.element=s,this.setStyle(),this.schema=i,this.parent=l,this.key=e,this.path=t,this.currentValues={},this.types=i?n.getDefaultAvailableTypes(i):[];const a=n.getType(o);if(this.currentType="","undefined"!==a)this.currentType=a,this.types.push(a),this.setCurrentTypeValue(o);else if(this.schema){const e=n.getDefaultValue(this.schema);this.currentType=e.type,this.setCurrentTypeValue(e.value)}this.types=[...new Set(this.types)],this.updateElement()}update(){this.parent.update()}validate(){this.parent.validate()}getPath(e){for(let t=0;t<this.arrayElements.length;t++)if(this.arrayElements[t]===e)return`${this.path}.${t}`;for(const t in this.objectElements)if(this.objectElements[t]===e)return`${this.path}.${t}`;return`${this.path}.?`}getState(){return this.parent.getState()}deleteChild(e){if("string"==typeof e){const t=this.getValue();delete t[e],this.setCurrentTypeValue(t),this.updateElement()}else if("number"==typeof e){const t=[...this.getValue()];t.splice(e,1),this.setCurrentTypeValue(t),this.updateElement()}}setCurrentTypeValue(e){this.currentValues[this.currentType]=void 0!==e?JSON.parse(JSON.stringify(e)):void 0,this.validate&&this.validate()}static addDescription(e,t,n){n&&(t=`${t?`${t}\n`:""}Examples:\n${n.map((e=>JSON.stringify(e))).join(",\n")}`),t&&(e.title=t,e.style.textDecoration="underline dotted",e.style.cursor="help")}static getType(e){return void 0===e?"undefined":Array.isArray(e)?"array":null===e?"null":typeof e}static isInteger(e){if(!e)return!1;const t=Array.isArray(e.type)?e.type:[e.type];return t.includes("integer")&&!t.includes("number")}static getDefaultAvailableTypes(e){let t=Array.isArray(e.type)?[...e.type]:[e.type];return t=t.map((e=>"integer"===e?"number":e)),t}static getDefaultValue(e){const t=this.getDefaultAvailableTypes(e);return void 0!==e.default?{type:this.getType(e.default),value:e.default}:e.examples&&e.examples.length>0?{type:this.getType(e.examples[0]),value:e.examples[0]}:{type:t[0],value:this.getDefaultValueForType(e,t[0])}}static getDefaultValueForType(e,t){var n,s,i;if("null"===t)return null;if("number"===t)return this.isInteger(e)?Math.ceil(null!==(n=null==e?void 0:e.minimum)&&void 0!==n?n:0):null!==(s=null==e?void 0:e.minimum)&&void 0!==s?s:0;if("string"===t)return(null==e?void 0:e.enum)?e.enum[0]:"color"===(null==e?void 0:e.format)?"#000000":"date"===(null==e?void 0:e.format)?(new Date).toDateString():"";if("boolean"===t)return!1;if("array"===t)return[];if("object"===t){const t={};if(null==e?void 0:e.properties)for(const n of null!==(i=e.required)&&void 0!==i?i:[]){if(!e.properties.hasOwnProperty(n))continue;const s=this.getDefaultValue(e.properties[n]);t[n]=s.value}return t}}updateElement(){var e,t,s,i,o,l,a,r,c,d,h,u,p,m,v,y,f,g,b,j,T,E,x,V,L;this.objectElements={},this.arrayElements=[],this.element.innerHTML="",this.element.style.display="inline-block",this.element.classList.remove("json-tool-object"),this.element.append(this.createLineNumber());const k=this.currentType,C=null!==(e=this.currentValues[k])&&void 0!==e?e:this.currentValues[k]=n.getDefaultValueForType(this.schema,k),w=document.createElement("div");if(w.classList.add("json-tool-types"),this.element.append(w),this.types.length>1||k!==this.types[0]){const e=document.createElement("select");e.classList.add("json-tool-type");for(const t of this.types){const n=document.createElement("option");n.innerText=t,n.value=t,e.append(n)}e.value=this.currentType,e.onchange=()=>{this.changeType(e.value)},w.append(e)}const D=document.createElement("div");if(D.classList.add("json-tool-btn"),D.style.display="inline-block",D.style.marginLeft="5px",D.innerText="*",D.onclick=()=>{var e;const t=["object","array","boolean","string","number","null","undefined"],n=null!==(e=window.prompt(`Enter new type:\n${t.join(", ")}`))&&void 0!==e?e:"";t.includes(n)&&("undefined"===n?this.parent.deleteChild(this.key):this.changeType(n))},w.append(D),"object"===k){this.element.append(this.createLineNumber(!0)),this.element.style.display="block",this.element.classList.add("json-tool-object"),this.element.append("{");const e=this.createBlock();this.element.append(e);const a=document.createElement("div");a.classList.add("json-tool-btn"),a.innerText="+",this.element.append(a),a.onclick=()=>{const e=prompt("Add new key?");if(e){const t=this.getValue();t[e]=null,this.setCurrentTypeValue(t),this.updateElement()}},this.element.append("}"),this.element.append(this.createLineNumber());for(const n in null!=C?C:{}){const l=this.createObjectKeyValuePair(n,(null===(t=this.schema)||void 0===t?void 0:t.properties)?this.schema.properties[n]:null,C[n]);e.append(l);const a=document.createElement("div");if(l.prepend(a),a.classList.add("json-tool-btns"),(null===(s=this.schema)||void 0===s?void 0:s.properties)&&!this.schema.properties.hasOwnProperty(n)){const e=document.createElement("div");e.classList.add("json-tool-btn"),e.innerText="X",e.onclick=()=>{const e=this.getValue();delete e[n],this.setCurrentTypeValue(e),this.updateElement()},a.append(e)}else if(!(null===(o=null===(i=this.schema)||void 0===i?void 0:i.required)||void 0===o?void 0:o.includes(n))){const e=document.createElement("div");e.classList.add("json-tool-btn"),e.innerText="∽",e.onclick=()=>{this.deleteChild(n)},a.append(e)}}if(null===(l=this.schema)||void 0===l?void 0:l.properties)for(const t in this.schema.properties){if(null==C?void 0:C.hasOwnProperty(t))continue;const s=this.createObjectKeyValuePair(t,this.schema.properties[t],void 0,!0);e.append(s),s.style.textDecoration="line-through 2px";const i=document.createElement("div");s.prepend(i),i.classList.add("json-tool-btns");const o=document.createElement("div");o.classList.add("json-tool-btn"),o.innerText="≁",o.onclick=()=>{var e;if(null===(e=this.schema)||void 0===e?void 0:e.properties){const e=this.getValue();e[t]=n.getDefaultValue(this.schema.properties[t]).value,this.setCurrentTypeValue(e),this.updateElement()}},i.append(o)}}else if("array"===k){this.element.append(this.createLineNumber(!0)),this.element.style.display="block",this.element.classList.add("json-tool-object"),this.element.append("[");const e=this.createBlock();this.element.append(e);const t=document.createElement("div");t.classList.add("json-tool-btn"),t.innerText="+",this.element.append(t),t.onclick=()=>{var e,t;const s=[...this.getValue()];if(s.length===(null===(e=this.schema)||void 0===e?void 0:e.maxItems)&&!confirm("This array is at max capacity - really add more?"))return;const i=(null===(t=this.schema)||void 0===t?void 0:t.items)?n.getDefaultValue(this.schema.items).value:null;s.push(i),this.currentType=k,this.setCurrentTypeValue(s),this.setIsOpened(!0),this.updateElement()},this.element.append("]"),this.element.append(this.createLineNumber());const s=null!=C?C:[];for(let t=0;t<s.length;t++){const n=t,s=this.createObjectKeyValuePair(t,(null===(a=this.schema)||void 0===a?void 0:a.items)?this.schema.items:null,C[t]);e.append(s);const i=document.createElement("div");s.prepend(i),i.classList.add("json-tool-btns");const o=document.createElement("div");o.classList.add("json-tool-btn"),o.innerText="X",o.onclick=()=>{var e;[...this.getValue()].length!==(null===(e=this.schema)||void 0===e?void 0:e.minItems)&&this.deleteChild(n)},i.append(o);const l=document.createElement("div");l.classList.add("json-tool-btn"),l.innerText="ᐃ",l.onclick=()=>{let e=[...this.getValue()];const t=e.splice(n,1);e=e.slice(0,n-1).concat(t).concat(e.slice(n-1)),this.setCurrentTypeValue(e),this.updateElement()},i.append(l);const r=document.createElement("div");r.classList.add("json-tool-btn"),r.innerText="ᐁ",r.onclick=()=>{let e=[...this.getValue()];const t=e.splice(n,1);e=e.slice(0,n+1).concat(t).concat(e.slice(n+1)),this.setCurrentTypeValue(e),this.updateElement()},i.append(r)}}else if("boolean"===k){const e=document.createElement("input");e.type="checkbox",e.checked=C,e.onchange=()=>{this.setCurrentTypeValue(e.checked)},this.element.append(e)}else if("string"===k)if(null===(r=this.schema)||void 0===r?void 0:r.enum){const e=document.createElement("select");for(const t of[...new Set(this.schema.enum.concat(C))]){const n=document.createElement("option");n.innerText=t,n.value=t,e.append(n)}e.value=C,e.onchange=()=>{this.setCurrentTypeValue(e.value)},this.element.append(e)}else if("textarea"===(null===(c=this.schema)||void 0===c?void 0:c.format)){const e=document.createElement("textarea");e.value=C,e.minLength=null!==(h=null===(d=this.schema)||void 0===d?void 0:d.minLength)&&void 0!==h?h:0,e.maxLength=null!==(p=null===(u=this.schema)||void 0===u?void 0:u.maxLength)&&void 0!==p?p:99999999999999,e.onchange=()=>{this.setCurrentTypeValue(e.value)},this.element.append(e)}else if("date"===(null===(m=this.schema)||void 0===m?void 0:m.format)){const e=document.createElement("input");e.type="date",e.onchange=()=>{var t,n;this.setCurrentTypeValue(null!==(n=null===(t=e.valueAsDate)||void 0===t?void 0:t.toDateString())&&void 0!==n?n:"")},this.element.append(e),e.valueAsDate=new Date(C)}else{const e=document.createElement("input");e.type="text",(null===(v=this.schema)||void 0===v?void 0:v.format)&&["password","email","color","url"].includes(this.schema.format)&&(e.type=this.schema.format),e.value=C,e.minLength=null!==(f=null===(y=this.schema)||void 0===y?void 0:y.minLength)&&void 0!==f?f:0,e.maxLength=null!==(b=null===(g=this.schema)||void 0===g?void 0:g.maxLength)&&void 0!==b?b:99999999999999,e.onchange=()=>{this.setCurrentTypeValue(e.value)},this.element.append(e)}else if("null"===k)this.element.append("null");else if("number"===k){const e=document.createElement("input");e.type="number",e.value=C.toString(),e.min=null!==(E=null===(T=null===(j=this.schema)||void 0===j?void 0:j.minimum)||void 0===T?void 0:T.toString())&&void 0!==E?E:"",e.max=null!==(L=null===(V=null===(x=this.schema)||void 0===x?void 0:x.maximum)||void 0===V?void 0:V.toString())&&void 0!==L?L:"",n.isInteger(this.schema)&&(e.step="1"),e.onchange=()=>{this.setCurrentTypeValue(parseFloat(e.value))},this.element.append(e)}else this.element.append(`[${k}] : ${C}`);this.update()}createLineNumber(e=!1){const t=document.createElement("div");return t.classList.add("line-number"),e&&(t.style.marginTop="0"),t}isOpened(){var e;return null===(e=this.parent.getState()[`${this.path}_opened`])||void 0===e||e}setIsOpened(e){this.parent.getState()[`${this.path}_opened`]=e}createBlock(){const e=document.createElement("div");e.classList.add("json-tool-block"),e.style.paddingLeft="25px",e.style.borderLeft="1px dashed black",e.style.marginLeft="3px";const t=document.createElement("div");"root"!==this.path&&e.append(t),t.classList.add("json-tool-btn");const n=n=>{t.innerText=n?"ᐯ":"ᐳ",e.classList.remove("opened","closed"),e.classList.add(n?"opened":"closed")};return t.onclick=()=>{const e=!this.isOpened();this.setIsOpened(e),n(e)},n(this.isOpened()),e}createObjectKeyValuePair(e,t,s,i=!1){var o;const l=document.createElement("div"),a=e;e="number"==typeof e?(null==t?void 0:t.title)?`${t.title} ${e}`:e:null!==(o=null==t?void 0:t.title)&&void 0!==o?o:e;const r=document.createElement("span");if(r.innerText=e.toString(),n.addDescription(r,null==t?void 0:t.description,null==t?void 0:t.examples),l.append(r),l.classList.add("json-tool-key"),l.append(": "),!i){const e=document.createElement("div"),i=new n(a,`${this.path}.${a}`,e,t,s,this);"array"===this.currentType?this.arrayElements.push(i):"object"===this.currentType&&(this.objectElements[a]=i),l.append(e)}return l}changeType(e){var t;this.currentType=e,this.currentValues.hasOwnProperty(e)||(void 0!==(null===(t=this.schema)||void 0===t?void 0:t.default)&&n.getType(this.schema.default)===e?this.setCurrentTypeValue(this.schema.default):this.setCurrentTypeValue(n.getDefaultValueForType(this.schema,e))),this.updateElement()}setStyle(){this.element.style.whiteSpace="pre",this.element.classList.add("json-tool-value")}getValue(){var e;let t;if("array"===this.currentType)t=this.arrayElements.map((e=>e.getValue()));else if("object"===this.currentType){const e={};for(const t in this.objectElements)e[t]=this.objectElements[t].getValue();t=e}else t=null!==(e=this.currentValues[this.currentType])&&void 0!==e?e:n.getDefaultValueForType(this.schema,this.currentType);return this.currentValues[this.currentType]=t,t}}}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}(()=>{const e=n(671);window.JsonTool=e.JsonTool})()})();
//# sourceMappingURL=json-tool.js.map